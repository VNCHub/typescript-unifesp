{
  "version": 3,
  "sources": ["../../src/frontend/AuthFrontend.ts"],
  "sourcesContent": ["export class AuthFrontend {\n  private LOGIN_API = '/api/login';\n  private modal: any = null;\n\n  constructor() {\n    console.log('AuthFrontend initialized');\n  }\n\n  init() {\n    this.initModal();\n    this.bindEvents();\n    this.renderAuthState();\n  }\n\n  private $(sel: string) {\n    return document.querySelector(sel);\n  }\n\n  private initModal() {\n    const el = this.$('#authModal');\n    // @ts-ignore\n    this.modal = el ? new bootstrap.Modal(el) : null;\n  }\n\n  private bindEvents() {\n    const form = document.querySelector('#login-form') as HTMLFormElement | null;\n  document.querySelector('#login-form')?.addEventListener('submit', (e) => this.onLoginSubmit(e));\n  document.querySelector('#register-form')?.addEventListener('submit', (e) => this.onRegisterSubmit(e));\n\n  this.$('#btn-open-login')?.addEventListener('click', () => this.modal?.show());\n  this.$('#btn-logout')?.addEventListener('click', () => this.doLogout());\n  }\n\n  private showMsg(msg: string, type: 'success' | 'danger' | 'info' = 'info') {\n    const main = document.querySelector('main') || document.body;\n    const div = document.createElement('div');\n    div.className = `alert alert-${type} alert-dismissible fade show`;\n    div.innerHTML = `${msg}<button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>`;\n    main.prepend(div);\n    setTimeout(() => div.remove(), 4000);\n  }\n\n  private async doLogin(payload: { email: string; senha: string }) {\n    const res = await fetch(this.LOGIN_API, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(payload),\n    });\n\n    if (!res.ok) {\n      const body = await res.json().catch(() => null);\n      throw new Error(body?.message || 'Erro no login');\n    }\n\n    return res.json();\n  }\n\n  private async onLoginSubmit(e: Event) {\n    e.preventDefault();\n\n    const form = e.target as HTMLFormElement;\n\n    const email = (form.querySelector('[name=\"email\"]') as HTMLInputElement).value.trim();\n    const senha = (form.querySelector('[name=\"senha\"]') as HTMLInputElement).value.trim();\n\n    try {\n      const result = await this.doLogin({ email, senha });\n      console.log(result);\n      localStorage.setItem('token', result.token);\n      this.modal?.hide();\n      window.location.href = \"/\";\n    } catch (err: any) {\n      this.showMsg(err.message, 'danger');\n    }\n  }\n  \n  private async onRegisterSubmit(e: Event) {\n    e.preventDefault();\n\n    const form = e.target as HTMLFormElement;\n\n    const payload = {\n      nome: (form.querySelector('[name=\"nome\"]') as HTMLInputElement).value.trim(),\n      email: (form.querySelector('[name=\"email\"]') as HTMLInputElement).value.trim(),\n      senha: (form.querySelector('[name=\"senha\"]') as HTMLInputElement).value.trim(),\n      data_nascimento: (form.querySelector('[name=\"data_nascimento\"]') as HTMLInputElement).value.trim(),\n    };\n\n    try {\n      const res = await fetch('/api/register', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(payload),\n      });\n\n      if (!res.ok) throw new Error('Erro ao criar conta');\n\n      this.showMsg('Conta criada com sucesso!', 'success');\n      this.modal?.hide();\n    } catch (err: any) {\n      this.showMsg(err.message, 'danger');\n    }\n  }\n\n  private doLogout() {\n    localStorage.removeItem('token');\n    window.location.href = \"/\";\n  }\n\n  private renderAuthState() {\n    const token = localStorage.getItem('token');\n    const btnLogin = this.$('#btn-open-login') as HTMLElement;\n    const btnLogout = this.$('#btn-logout') as HTMLElement;\n    const btnManageSubjects = this.$('#btn-manage-subjects') as HTMLElement;\n    const lblUser = this.$('#auth-username');\n\n    if (!btnLogin || !btnLogout) return;\n\n    if (!token) {\n      btnLogin.style.display = '';\n      btnLogout.classList.add('d-none');\n      btnManageSubjects.classList.add('d-none');\n\n      if (lblUser) lblUser.textContent = '';\n      return;\n    }\n\n    const [, payloadBase64] = token.split('.');\n    const json = JSON.parse(atob(payloadBase64));\n    btnLogin.style.display = 'none';\n    btnLogout.classList.remove('d-none');\n    btnManageSubjects.classList.remove('d-none');\n    if (lblUser) lblUser.textContent = `Ol\u00E1, ${json?.nome ?? ''}`;\n    \n  }\n}\n"],
  "mappings": "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",
  "names": []
}

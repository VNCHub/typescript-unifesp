{
  "version": 3,
  "sources": ["../../src/frontend/SubjectsFrontend.ts"],
  "sourcesContent": ["export class SubjectsFrontend {\n  private API = \"/api/subjects\";\n  private tableBody: HTMLElement | null;\n  private modal: any = null;\n  private deleteModal: any = null;\n  private editingId: number | null = null;\n  private deleteId: number | null = null;\n\n  constructor() {\n    this.tableBody = document.getElementById(\"subjects-table-body\");\n  }\n\n  init() {\n    if (!this.tableBody) return;\n\n    this.initModals();\n    this.bindEvents();\n    this.loadAndRender();\n  }\n\n  private $(sel: string) {\n    return document.querySelector(sel) as HTMLElement | null;\n  }\n\n  private initModals() {\n    const modalEl = document.getElementById(\"subjectModal\");\n    // @ts-ignore\n    this.modal = modalEl ? new bootstrap.Modal(modalEl) : null;\n\n    const delEl = document.getElementById(\"confirmDeleteModal\");\n    // @ts-ignore\n    this.deleteModal = delEl ? new bootstrap.Modal(delEl) : null;\n  }\n\n  private bindEvents() {\n    this.$(\"#btn-new-subject\")?.addEventListener(\"click\", () => this.openCreate());\n\n    const form = document.getElementById(\"subject-form\") as HTMLFormElement | null;\n    form?.addEventListener(\"submit\", (e) => this.onFormSubmit(e));\n\n    this.$(\"#btn-confirm-delete\")?.addEventListener(\"click\", () => this.confirmDelete());\n  }\n\n  private showMsg(msg: string, type: \"success\" | \"danger\" | \"info\" = \"info\") {\n    const main = document.querySelector(\"main\") || document.body;\n    const div = document.createElement(\"div\");\n\n    div.className = `alert alert-${type} alert-dismissible fade show`;\n    div.innerHTML = `\n      ${msg}\n      <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>\n    `;\n\n    main.prepend(div);\n    setTimeout(() => div.remove(), 4000);\n  }\n\n  private async fetchSubjects() {\n    const res = await fetch(this.API);\n    if (!res.ok) throw new Error(\"Erro ao carregar mat\u00E9rias.\");\n    return res.json();\n  }\n\n  private async fetchProfessores() {\n  const res = await fetch(\"/api/professors\");\n  if (!res.ok) throw new Error(\"Erro ao carregar professores\");\n  return res.json();\n  }\n\n  private async loadProfessoresSelect(selectedId: number | null = null) {\n    const select = document.getElementById(\"input-professorId\") as HTMLSelectElement;\n    if (!select) return;\n\n    // limpa antes\n    select.innerHTML = `<option value=\"\">Selecione um professor...</option>`;\n\n    try {\n      const profs = await this.fetchProfessores();\n\n      profs.forEach((p: any) => {\n        const opt = document.createElement(\"option\");\n        opt.value = String(p.id);\n        opt.textContent = `${p.nome}`;\n\n        if (selectedId && selectedId === p.id) opt.selected = true;\n\n        select.appendChild(opt);\n      });\n    } catch {\n      this.showMsg(\"Erro ao carregar lista de professores.\", \"danger\");\n    }\n  }\n\n  private async loadAndRender() {\n    if (!this.tableBody) return;\n\n    try {\n      const data = await this.fetchSubjects();\n      this.renderTable(data);\n    } catch (err: any) {\n      this.tableBody.innerHTML = `\n        <tr><td colspan=\"6\" class=\"text-danger text-center\">Erro ao carregar.</td></tr>\n      `;\n    }\n  }\n\n  private renderTable(items: any[]) {\n    if (!this.tableBody) return;\n\n    if (!items.length) {\n      this.tableBody.innerHTML = `\n        <tr><td colspan=\"6\" class=\"text-center text-muted\">Nenhuma mat\u00E9ria cadastrada.</td></tr>\n      `;\n      return;\n    }\n\n    this.tableBody.innerHTML = items\n      .map((s) => {\n        return `\n        <tr>\n          <td>${s.id}</td>\n          <td>${this.escape(s.nome)}</td>\n          <td>${this.escape(s.professor?.nome ?? \"\u2014\")}</td>\n          <td>${this.escape(s.horario ?? \"\u2014\")}</td>\n          <td>${this.escape(s.sala ?? \"\u2014\")}</td>\n          <td class=\"text-end\">\n            <button class=\"btn btn-sm btn-outline-primary me-2\" data-edit=\"${s.id}\">Editar</button>\n            <button class=\"btn btn-sm btn-outline-danger\" data-delete=\"${s.id}\" data-name=\"${this.escape(s.nome)}\">Excluir</button>\n          </td>\n        </tr>\n      `;\n      })\n      .join(\"\");\n\n    // bind edit/delete buttons\n    this.tableBody.querySelectorAll(\"[data-edit]\").forEach((btn) =>\n      btn.addEventListener(\"click\", (e) => this.onEdit(e))\n    );\n\n    this.tableBody.querySelectorAll(\"[data-delete]\").forEach((btn) =>\n      btn.addEventListener(\"click\", (e) => this.onAskDelete(e))\n    );\n  }\n\n  private escape(s = \"\") {\n    return String(s).replace(/[&<>\"']/g, (m) => {\n      return { \"&\": \"&amp;\", \"<\": \"&lt;\", \">\": \"&gt;\", '\"': \"&quot;\", \"'\": \"&#39;\" }[m]!;\n    });\n  }\n\n  private openCreate() {\n    this.editingId = null;\n\n    (document.getElementById(\"subject-form\") as HTMLFormElement).reset();\n    this.$(\"#modalTitle\")!.textContent = \"Nova mat\u00E9ria\";\n    this.loadProfessoresSelect(null);\n\n    this.modal?.show();\n  }\n\n  private async onEdit(e: Event) {\n    const id = Number((e.currentTarget as HTMLElement).dataset.edit);\n    if (!id) return;\n\n    try {\n      const res = await fetch(`${this.API}/${id}`);\n      const item = await res.json();\n\n      this.editingId = item.id;\n\n      (document.getElementById(\"input-id\") as HTMLInputElement).value = item.id;\n      (document.getElementById(\"input-nome\") as HTMLInputElement).value = item.nome;\n      (document.getElementById(\"input-descricao\") as HTMLTextAreaElement).value = item.descricao ?? \"\";\n      await this.loadProfessoresSelect(item.professorId);\n      (document.getElementById(\"input-horario\") as HTMLInputElement).value = item.horario ?? \"\";\n      (document.getElementById(\"input-sala\") as HTMLInputElement).value = item.sala ?? \"\";\n\n      this.$(\"#modalTitle\")!.textContent = \"Editar mat\u00E9ria\";\n      this.modal?.show();\n    } catch {\n      this.showMsg(\"Erro ao carregar mat\u00E9ria.\", \"danger\");\n    }\n  }\n\n  private async onFormSubmit(e: Event) {\n    e.preventDefault();\n\n    const payload = {\n      nome: (document.getElementById(\"input-nome\") as HTMLInputElement).value.trim(),\n      descricao: (document.getElementById(\"input-descricao\") as HTMLTextAreaElement).value.trim() || null,\n      professorId: Number((document.getElementById(\"input-professorId\") as HTMLInputElement).value.trim()),\n      horario: (document.getElementById(\"input-horario\") as HTMLInputElement).value.trim() || null,\n      sala: (document.getElementById(\"input-sala\") as HTMLInputElement).value.trim() || null,\n    };\n\n    const url = this.editingId ? `${this.API}/${this.editingId}` : this.API;\n    const method = this.editingId ? \"PUT\" : \"POST\";\n\n    const res = await fetch(url, {\n      method,\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(payload),\n    });\n\n    if (!res.ok) return this.showMsg(\"Erro ao salvar mat\u00E9ria.\", \"danger\");\n\n    this.modal?.hide();\n    this.showMsg(this.editingId ? \"Mat\u00E9ria atualizada!\" : \"Mat\u00E9ria criada!\", \"success\");\n\n    this.loadAndRender();\n  }\n\n  private onAskDelete(e: Event) {\n    const btn = e.currentTarget as HTMLElement;\n\n    this.deleteId = Number(btn.dataset.delete);\n    const name = btn.dataset.name;\n\n    this.$(\"#delete-item-name\")!.textContent = name ?? \"\";\n    this.deleteModal?.show();\n  }\n\n  private async confirmDelete() {\n    if (!this.deleteId) return;\n\n    const res = await fetch(`${this.API}/${this.deleteId}`, { method: \"DELETE\" });\n\n    if (!res.ok && res.status !== 204) {\n      this.showMsg(\"Erro ao excluir mat\u00E9ria.\", \"danger\");\n      return;\n    }\n\n    this.deleteModal?.hide();\n    this.showMsg(\"Mat\u00E9ria exclu\u00EDda.\", \"success\");\n\n    this.loadAndRender();\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
